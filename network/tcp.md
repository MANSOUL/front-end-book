### TCP 特性

- 提供面向连接的可靠的字节流服务
- 一个连接仅有两方进行彼此同心
- 使用校验和、确认、重传来保证可靠传输
- 给数据分节进行排序、并使用累积确认保证数据的顺序不变和非重复
- 使用滑动窗口机制来实现流量控制、通过动态改变窗口大小进行拥塞控制

### 三次握手四次挥手

三次握手是指在进行TCP连接时需要客户端和服务端总共发送三个包，目的是连接服务器指定端口，建立TCP连接，并同步双方的序列号和确认号交换TCP窗口大小信息。

- 第一次握手（SYN=1，seq=x)
    客户端发送一个TCP的SYN标志位为1的包，指明客户端打算连接的服务器的端口，以及初始序列号x存放在序列号字段中
    发送完毕后，客户端进行 `SYN_SEND` 状态
- 第二次握手（SYN=1，ACK=1，seq=y,ACKnum=x+1）
    服务器发回确认包（ACK）应答（SYN和ACK均为1）。服务端将自己的序列号放在Seq中，同时将确认序列号设置为客户端序列号+1。
    发送完毕后进入 `SYN_REVD` 状态。
- 第三次握手（ACK=1，ACKnum=y+1）
    客户端再次发送确认包，冰冰酱确认序列号设置为服务端序列+1。
    发送完毕后客户端进行 `ESTABLISHED` 状态，当服务端收到这个包后也进入 `ESTABLISHED` 转台。


四次挥手是指断开TCP连接需要发送四个包，客户端和服务端均可主动发起挥手动作。

- 第一次挥手（FIN=1，seq=x）
    
    主动挥手方发送FIN标志位为1的包，表示自己已经没有数据需要发送了，但是任然可以接收数据。
    发送完毕后进入 `CLOSE_WAIT_1` 状态。

- 第二次挥手（ACK=1，ACKnum=x+1）
    
    接收方确认到对方的FIN包，发送一个确认包，表明自己接受关闭请求，但是还没有准备好断开连接。

    发送完毕后，进入 `CLOSE_WAIT` 状态，发起方收到此包后进入 `CLOSE_WAIT_2` 状态。

- 第三次挥手（FIN=1，seq=y）

    接收方准备好关闭连接时，向发起方发送结束连接包，设置FIN为1。

    发送完毕后，接收方进入 `LASK_ACK` 状态，等待来自己发起方的最后一个ACK。

- 第四次挥手（ACK=1，ACKnum=y+1）

    发起方收到对方的结束请求，发送一个确认包，并进入 `TIME_WAIT` 状态，等待可能出现的要求重传的ACK包。

    接收方收到确认包后，关闭连接，进入 `CLOSED` 状态。

    发起方等地啊某个固定时间（两个最大段生命周期，2MSL）之后，没有收到接收方的ACK则认为接收方已经正常关闭连接，于是自己也关闭连接，进入 `CLOSED` 状态。
