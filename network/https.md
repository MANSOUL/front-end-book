### Https握手

![https握手](./images/7.jpg)

1. client-hello 阶段：浏览器发送支持的加密算法、随机数1、支持的加密套件
2. server-hello 阶段：服务器返回随机数2、选用的加密套件
3. server-certificate 阶段：服务器发送CA证书，包含
    - 身份验证
    - 公钥
4. server-hello-done 阶段：客户端收到此消息即开始验证证书合法性并开始协商主密钥
5. 浏览器验证证书的合法性
    - 证书有效期
    - 域名
    - 吊销状态
    - 颁发机构
6. 浏览器生成随机数3，并使用随机数1+随机数2+随机数3计算出**对称加密**所需要的密钥，并通过证书中的公钥加密
7. 将加密后的公钥发送给服务器，告诉服务器已经计算好了加密需要的密钥接下来就是用这个密钥进行加密传输了
8. 服务器通过私钥解密，获取对称加密密钥，服务器在发送一条消息，我已经获取到了密钥，接下来就可以使用加密传输了
9. Finished：7、8阶段双方会验证对方发送的Finished消息，保证密钥是可用的，验证数据包含：
    - 主密钥
    - 标签，客户端为client finished, 服务端为server finished
    - 所有的握手协议信息

### 为什么要使用对称加密？

> 非对称加密的加解密效率是非常低的，而 http 的应用场景中通常端与端之间存在大量的交互，非对称加密的效率是无法接受的。


