### 跨站脚本攻击（XSS）

XSS 攻击可分为 **存储型**、**反射型**、**DOM型** 三种，此三种类型主要区别在于存储区以及 插入点的不同。

#### 存储型

存储型的攻击步骤：

1. 攻击者将恶意代码注入到数据库中。
2. 用户打开网站时，服务端将恶意代码从数据库中取出，并拼接入HTML中，返回给浏览器。
3. 浏览器解析并执行恶意代码。
4. 恶意代码窃取用户数据并发送给攻击者，货冒充用户调用网站接口执行攻击操作。

这种攻击常见于可保存用户数据的网站，如带有发帖，评论，私信功能的网站。

#### 反射型

反射型攻击与存储型攻击的主要区别在于恶意代码的存储位置不同，存储型保存于数据库中，而反射型保存于URL上。
其攻击步骤为：
1. 攻击者构造带有攻击代码的恶意URL，并引诱用户打开。
2. 服务端从URL上取出恶意代码并将其拼接入HTML中，返回给浏览器。
3. 浏览器解析并执行恶意代码。
4. 恶意代码窃取用户数据并发送给攻击者，货冒充用户调用网站接口执行攻击操作。

这种攻击常见于需要通过URL传递参数的的网站，如搜索站。


#### DOM型

DOM型攻击与反射型攻击的区别在于恶意代码是有客户端JS取出，并插入到HTML中。

其攻击步骤为：
1. 攻击者构造带有攻击代码的恶意URL，并引诱用户打开。
2. 客户端JS从URL上取出恶意代码并将其注入到HTML中。
3. 浏览器解析并执行恶意代码。
4. 恶意代码窃取用户数据并发送给攻击者，货冒充用户调用网站接口执行攻击操作。

#### 防范XSS

1. 改为纯前端渲染。
2. 服务端在注入数据到HTML中时，做充分转义， 主要是将 `& <> " ' /` 转义。
3. 尽量不要使用 `innerHTML`, `outerHTML`, `document.write()` 而应该使用 `textContent`, `innerText`。
4. 小心设置 `onclick`, `onerror`, `onload`, `href` 等能将字符串专为代码运行的属性。

通过渲染页面和执行JavaScript时的转义，能够有效防止XSS，另外还有一种叫做[内容安全策略](内容安全策略[CSP].md)的方案可以降低XSS带来的风险。

